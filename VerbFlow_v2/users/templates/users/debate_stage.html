{% extends 'users/base.html' %}
{% load static %}
{% block content %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    
    <h1>Debate between {{username}} and AI</h1>

    <div id="message-container">
        <!-- Messages will be displayed here -->
    </div>

    <div id="input-container">
        <input type="text" id="user-input" placeholder="Your message...">
        <button id="send-button" onclick="sendMessage()">Send</button>
        <button id="start-audio-button" onclick="startSpeechRecognition()">Start Audio</button>
        <button id="stop-audio-button" onclick="stopSpeechRecognition()" style="display: none;">Stop Audio</button>
    </div>

    <script>
        var recognition;

        // Function to send text message
        function sendMessage() {
            var userInput = document.getElementById("user-input").value;
            sendMessageToAI(userInput);
        }

        // Function to send audio message
        function sendAudioMessage(audioText) {
            sendMessageToAI(audioText);
        }

        // Function to send message to AI
        function sendMessageToAI(message) {
            var messageContainer = document.getElementById("message-container");

            // Create new message div for user
            var userMessageDiv = document.createElement("div");
            userMessageDiv.classList.add("user-message");
            userMessageDiv.innerHTML = "<h2>{{username}}:</h2><p>" + message + "</p>";
            messageContainer.appendChild(userMessageDiv);

            // Clear user input field
            document.getElementById("user-input").value = "";

            // Simulate AI's response (this can be replaced with actual AI logic)
            var aiResponse = "I am an AI. I don't have feelings, but I can provide information.";

            // Create new message div for AI
            var aiMessageDiv = document.createElement("div");
            aiMessageDiv.classList.add("ai-message");
            aiMessageDiv.innerHTML = "<h2>AI:</h2><p>" + aiResponse + "</p>";
            messageContainer.appendChild(aiMessageDiv);

            // Scroll to the bottom of the page to show the latest message
            window.scrollTo(0,document.body.scrollHeight);
        }

        // Function to handle Enter key press
        document.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                sendMessage(); // Call sendMessage() function when Enter key is pressed
            }
        });

        // Function to start speech recognition
        function startSpeechRecognition() {
            recognition = new webkitSpeechRecognition() || new SpeechRecognition(); // For cross-browser support
            recognition.lang = "en-US"; // Set language to English (United States)
            recognition.continuous = true;
            recognition.interimResults = false; // Set this to true if you want interim results
            recognition.maxAlternatives = 1;
            recognition.onresult = function(event) {
                var audioText = event.results[0][0].transcript;
                sendAudioMessage(audioText);
            }
            recognition.start();

            // Toggle button visibility
            document.getElementById("start-audio-button").style.display = "none";
            document.getElementById("stop-audio-button").style.display = "inline-block";
        }

        // Function to stop speech recognition
        function stopSpeechRecognition() {
            if (recognition) {
                recognition.stop();
                recognition = null; // Reset recognition object
            }

            // Toggle button visibility
            document.getElementById("start-audio-button").style.display = "inline-block";
            document.getElementById("stop-audio-button").style.display = "none";
        }
    </script>
{% endblock content %}
